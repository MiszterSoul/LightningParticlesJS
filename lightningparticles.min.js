var i,t;i=this,t=function(){"use strict";class i{static VERSION="2.0.0";static DEFAULTS=Object.freeze({particleCount:350,particleColor:"#4a4a4a",particleOpacity:.8,particleMinSize:.5,particleMaxSize:2,particleSpeed:1,particleBlendMode:"source-over",minParticleCount:25,maxParticleCount:1500,particleAdjustStep:15,lineColor:"#ffffff",lineOpacity:.6,lineThickness:.5,maxDistance:50,lightningColor:"#00ffff",lightningGlowColor:"#00ffff",lightningOpacity:.8,lightningThickness:2,lightningFrequency:.03,lightningGlow:100,globalLightningDirection:!1,lightningAngle:Math.PI/2,lightningThroughParticles:!0,minLightningSegments:3,maxLightningSegments:20,enableSplits:!0,minSplitSegments:3,maxSplits:3,splitProbability:.3,minLightningLifetime:30,maxLightningLifetime:60,instantLightning:!1,lightningBlendMode:"source-over",enableLightningOnCollision:!1,collisionLightningColor:"#ff0000",collisionLightningGlowColor:"#ff0000",collisionLightningOpacity:.9,collisionLightningThickness:3,collisionLightningLifetime:50,collisionLightningDelay:1e3,collisionLightningMinDistance:15,collisionLightningIntensity:50,collisionEnableSplits:!0,collisionSplitProbability:.3,collisionMinSplitSegments:3,collisionMaxSplits:3,backgroundColor:"rgba(0, 0, 0, 0.75)",fpsLimit:60,pauseOnBlur:!0,referenceResolution:{width:1920,height:1080},referenceParticleCount:350,minFPS:5,maxFPS:144,pauseOnScroll:!1,borderOffset:5,resetOnResume:!1});constructor(t,n={}){if(!(t instanceof HTMLCanvasElement))throw new TypeError("LightningParticle: First argument must be an HTMLCanvasElement");this.canvas=t,this.ctx=t.getContext("2d",{alpha:!0,desynchronized:!0}),this.config={...i.DEFAULTS},this._applyConfig(n),this._initState(),this._boundResize=this.resize.bind(this),this._boundAnimate=this._animate.bind(this),this._boundHandleVisibility=this._handleVisibilityChange.bind(this),this._boundHandleFocus=this._handleFocus.bind(this),this._boundHandleBlur=this._handleBlur.bind(this),this._setupEventListeners(),this.resize(),this._rafId=requestAnimationFrame(this._boundAnimate)}_applyConfig(i){for(const t in i)Object.prototype.hasOwnProperty.call(i,t)&&void 0!==i[t]&&(this.config[t]=i[t]);void 0===i.referenceParticleCount&&(this.config.referenceParticleCount=this.config.particleCount)}_initState(){this.particles=[],this.lightning=[],this._lightningPool=[],this._spatialGrid=new Map,this._gridCellSize=this.config.maxDistance,this._lastTime=0,this._deltaTime=0,this._fpsInterval=1e3/this.config.fpsLimit,this._targetFrameTime=1e3/60,this._fps=0,this._frameCount=0,this._lastFpsUpdate=0,this._isRunning=!0,this._isPaused=!1,this._isScrollPaused=!1,this.avoidableAreas=[],this._lastCollisionLightningTime=0,this._collisionLightningPositions=[],this._maxDistanceSquared=this.config.maxDistance**2,this._dampingFactor=.9,this._tempPoint={x:0,y:0}}_setupEventListeners(){window.addEventListener("resize",this._boundResize,{passive:!0}),document.addEventListener("visibilitychange",this._boundHandleVisibility),window.addEventListener("focus",this._boundHandleFocus),window.addEventListener("blur",this._boundHandleBlur),this.config.pauseOnScroll&&(this._observer=new IntersectionObserver(i=>{i[0].isIntersecting?(this._isScrollPaused=!1,this.resume()):(this._isScrollPaused=!0,this.pause())},{threshold:0}),this._observer.observe(this.canvas))}_removeEventListeners(){window.removeEventListener("resize",this._boundResize),document.removeEventListener("visibilitychange",this._boundHandleVisibility),window.removeEventListener("focus",this._boundHandleFocus),window.removeEventListener("blur",this._boundHandleBlur),this._observer&&(this._observer.disconnect(),this._observer=null)}resize(){const{clientWidth:i,clientHeight:t}=this.canvas;if(0===i||0===t)return;this.canvas.width=i,this.canvas.height=t;const n=i*t,e=this.config.referenceResolution.width*this.config.referenceResolution.height,s=this.config.referenceParticleCount/e;let l=Math.round(s*n);l=Math.max(this.config.minParticleCount,Math.min(l,this.config.maxParticleCount)),this.config.particleCount=l;const o=this.particles.length;for(let n=0;n<o;n++){const e=this.particles[n];e.x=Math.max(e.radius,Math.min(e.x,i-e.radius)),e.y=Math.max(e.radius,Math.min(e.y,t-e.radius))}this._adjustParticleCount(),this._gridCellSize=this.config.maxDistance}_adjustParticleCount(){const i=this.config.particleCount;for(;this.particles.length>i;)this.particles.pop();for(;this.particles.length<i;)this._createParticle()}_createParticle(){const{particleMinSize:i,particleMaxSize:t,particleSpeed:n,borderOffset:e}=this.config,s=Math.random()*(t-i)+i,l=this.canvas.width-e-s,o=this.canvas.height-e-s,h=e+s,a=e+s,r=Math.random()*Math.PI*2;this.particles.push({x:Math.random()*(l-h)+h,y:Math.random()*(o-a)+a,radius:s,vx:Math.cos(r)*n,vy:Math.sin(r)*n})}_updateSpatialGrid(){this._spatialGrid.clear();const i=this._gridCellSize;for(let t=0,n=this.particles.length;t<n;t++){const n=this.particles[t],e=`${Math.floor(n.x/i)},${Math.floor(n.y/i)}`;this._spatialGrid.has(e)||this._spatialGrid.set(e,[]),this._spatialGrid.get(e).push(t)}}_getNeighborIndices(i,t){const n=this._gridCellSize,e=Math.floor(i/n),s=Math.floor(t/n),l=[];for(let i=-1;i<=1;i++)for(let t=-1;t<=1;t++){const n=`${e+i},${s+t}`,o=this._spatialGrid.get(n);o&&l.push(...o)}return l}_updateParticles(){const{particleSpeed:i,borderOffset:t,enableLightningOnCollision:n,collisionLightningDelay:e,collisionLightningMinDistance:s}=this.config,l=this._deltaTime/this._targetFrameTime,o=this.canvas.width,h=this.canvas.height,a=this._dampingFactor;for(let n=0,e=this.particles.length;n<e;n++){const e=this.particles[n],s=e.x,r=e.y;e.x+=e.vx*l,e.y+=e.vy*l;const c=this._checkAreaCollision(e,s,r);c&&this._handleAreaCollision(e,c,a),this._handleBoundaryCollision(e,o,h,t,a),this._normalizeVelocity(e,i)}}_checkAreaCollision(i,t,n){const e=this.avoidableAreas,s=e.length;for(let t=0;t<s;t++){const n=e[t],s=i.radius;if(i.x+s>n.x&&i.x-s<n.x+n.width&&i.y+s>n.y&&i.y-s<n.y+n.height){const t=Math.abs(i.x-n.x),e=Math.abs(i.x-(n.x+n.width)),s=Math.abs(i.y-n.y),l=Math.abs(i.y-(n.y+n.height)),o=Math.min(t,e,s,l);let h,a;return o===t?(h="left",a={x:n.x,y:i.y}):o===e?(h="right",a={x:n.x+n.width,y:i.y}):o===s?(h="top",a={x:i.x,y:n.y}):(h="bottom",a={x:i.x,y:n.y+n.height}),{area:n,side:h,collisionPoint:a}}}return null}_handleAreaCollision(i,t,n){const{area:e,side:s,collisionPoint:l}=t;"left"===s||"right"===s?(i.vx=-i.vx*n,i.x="left"===s?e.x-i.radius:e.x+e.width+i.radius):(i.vy=-i.vy*n,i.y="top"===s?e.y-i.radius:e.y+e.height+i.radius),this.config.enableLightningOnCollision&&this._triggerCollisionLightning(l)}_handleBoundaryCollision(i,t,n,e,s){const l=i.radius;i.x-l<e?(i.vx=-i.vx*s,i.x=e+l,this.config.enableLightningOnCollision&&this._triggerCollisionLightning({x:e,y:i.y})):i.x+l>t-e&&(i.vx=-i.vx*s,i.x=t-e-l,this.config.enableLightningOnCollision&&this._triggerCollisionLightning({x:t-e,y:i.y})),i.y-l<e?(i.vy=-i.vy*s,i.y=e+l,this.config.enableLightningOnCollision&&this._triggerCollisionLightning({x:i.x,y:e})):i.y+l>n-e&&(i.vy=-i.vy*s,i.y=n-e-l,this.config.enableLightningOnCollision&&this._triggerCollisionLightning({x:i.x,y:n-e}))}_normalizeVelocity(i,t){const n=Math.sqrt(i.vx**2+i.vy**2);if(n>.01){const e=t/n;i.vx*=e,i.vy*=e}else{const n=Math.random()*Math.PI*2;i.vx=Math.cos(n)*t,i.vy=Math.sin(n)*t}}_drawParticles(){const i=this.ctx,{particleBlendMode:t,particleOpacity:n,particleColor:e}=this.config;i.globalCompositeOperation=t,i.globalAlpha=n,i.fillStyle=e,i.beginPath();for(let t=0,n=this.particles.length;t<n;t++){const n=this.particles[t];i.moveTo(n.x+n.radius,n.y),i.arc(n.x,n.y,n.radius,0,2*Math.PI)}i.fill(),i.globalAlpha=1,i.globalCompositeOperation="source-over"}_connectParticles(){const i=this.ctx,{lineOpacity:t,lineColor:n,lineThickness:e}=this.config,s=this._maxDistanceSquared,l=this.particles;this._updateSpatialGrid(),i.globalAlpha=t,i.strokeStyle=n,i.lineWidth=e,i.beginPath();const o=new Set;for(let t=0,n=l.length;t<n;t++){const n=l[t],e=this._getNeighborIndices(n.x,n.y);for(let h=0,a=e.length;h<a;h++){const a=e[h];if(a<=t)continue;const r=t<a?`${t}-${a}`:`${a}-${t}`;if(o.has(r))continue;o.add(r);const c=l[a],g=n.x-c.x,d=n.y-c.y;g*g+d*d<s&&(i.moveTo(n.x,n.y),i.lineTo(c.x,c.y))}}i.stroke(),i.globalAlpha=1}_findClosestParticle(i,t){let n=1/0,e=null;for(let s=0,l=this.particles.length;s<l;s++){const l=this.particles[s],o=l.x-i,h=l.y-t,a=o*o+h*h;a<n&&(n=a,e=l)}return e}_getLightningBolt(){return this._lightningPool.length>0?this._lightningPool.pop():{points:[],color:"",glowColor:"",alpha:0,lifetime:0,currentLifetime:0,thickness:0,intensity:0}}_recycleLightningBolt(i){i.points.length=0,this._lightningPool.push(i)}createLightning(i=null,t=null,n=null,e=null,s=null,l=null,o=null,h=null,a="general"){const r=this.config;if("collision"===a&&!r.collisionEnableSplits)return;if("general"===a&&!r.enableSplits&&null!==n)return;if(0===this.particles.length&&null===i)return;let c=i??this.particles[Math.floor(Math.random()*this.particles.length)].x,g=t??this.particles[Math.floor(Math.random()*this.particles.length)].y;const d=this._getLightningBolt();d.points.push({x:c,y:g});let u=r.globalLightningDirection?r.lightningAngle:Math.random()*Math.PI*2;const p=n??Math.floor(Math.random()*(r.maxLightningSegments-r.minLightningSegments+1))+r.minLightningSegments,f="collision"===a?r.collisionEnableSplits:r.enableSplits,m="collision"===a?r.collisionSplitProbability:r.splitProbability,_="collision"===a?r.collisionMinSplitSegments:r.minSplitSegments;for(let i=0;i<p;i++){const t=30*Math.random()+20;let e=c+Math.cos(u)*t,s=g+Math.sin(u)*t;if(r.lightningThroughParticles){const i=this._findClosestParticle(e,s);i&&(e=i.x,s=i.y)}if(d.points.push({x:e,y:s}),f&&Math.random()<m&&null===n){const t=Math.floor(Math.random()*(p-i-_))+_;t>0&&this.createLightning(e,s,t,null,null,null,null,null,a)}if(r.globalLightningDirection||(u+=(Math.random()-.5)*Math.PI/4),c=e,g=s,c<0||c>this.canvas.width||g<0||g>this.canvas.height)break}d.color=e??r.lightningColor,d.glowColor=s??r.lightningGlowColor,d.alpha=l??r.lightningOpacity,d.lifetime=n??Math.floor(Math.random()*(r.maxLightningLifetime-r.minLightningLifetime+1))+r.minLightningLifetime,d.currentLifetime=0,d.thickness=o??r.lightningThickness,d.intensity=h??r.lightningGlow,this.lightning.push(d)}_drawLightning(){const i=this.ctx,{lightningBlendMode:t,instantLightning:n}=this.config;i.globalCompositeOperation=t;for(let t=this.lightning.length-1;t>=0;t--){const e=this.lightning[t];i.save(),i.beginPath(),i.moveTo(e.points[0].x,e.points[0].y);const s=n?e.points.length:Math.floor(e.currentLifetime/e.lifetime*e.points.length);for(let t=1;t<s;t++)i.lineTo(e.points[t].x,e.points[t].y);i.shadowColor=e.glowColor,i.shadowBlur=e.intensity;const l=e.currentLifetime/e.lifetime,o=e.alpha*(1-l);i.globalAlpha=Math.max(0,o),i.strokeStyle=e.color,i.lineWidth=e.thickness,i.stroke(),i.restore(),e.currentLifetime++,e.currentLifetime>=e.lifetime&&(this._recycleLightningBolt(e),this.lightning.splice(t,1))}i.globalAlpha=1,i.globalCompositeOperation="source-over"}_drawBackground(){this.ctx.fillStyle=this.config.backgroundColor,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)}_triggerCollisionLightning(i){if(!this.config.enableLightningOnCollision)return;const t=performance.now(),n=this.config;this._collisionLightningPositions=this._collisionLightningPositions.filter(i=>t-i.time<n.collisionLightningDelay),t-this._lastCollisionLightningTime<n.collisionLightningDelay||this._collisionLightningPositions.every(t=>Math.hypot(i.x-t.x,i.y-t.y)>=n.collisionLightningMinDistance)&&(this.createLightning(i.x,i.y,n.collisionLightningLifetime,n.collisionLightningColor,n.collisionLightningGlowColor,n.collisionLightningOpacity,n.collisionLightningThickness,n.collisionLightningIntensity,"collision"),this._lastCollisionLightningTime=t,this._collisionLightningPositions.push({x:i.x,y:i.y,time:t}))}_animate(i){if(!this._isRunning)return;if(this._rafId=requestAnimationFrame(this._boundAnimate),this._isPaused)return;this._deltaTime=Math.min(i-this._lastTime,100),this._frameCount++;const t=performance.now(),n=t-this._lastFpsUpdate;n>=1e3&&(this._fps=this._frameCount/n*1e3,this._frameCount=0,this._lastFpsUpdate=t,this._adjustForPerformance()),i-this._lastTime<this._fpsInterval||(this._lastTime=i,this._drawBackground(),this.config.lightningOpacity>0&&Math.random()<this.config.lightningFrequency&&this.createLightning(),this._drawLightning(),this.particles.length<this.config.particleCount&&this._createParticle(),this._updateParticles(),this._connectParticles(),this._drawParticles())}_adjustForPerformance(){const{minFPS:i,maxFPS:t,minParticleCount:n,maxParticleCount:e,particleAdjustStep:s}=this.config;if(this._fps<i&&this.particles.length>n){const i=Math.min(s,this.particles.length-n);this.particles.length-=i}else if(this._fps>t&&this.particles.length<e){const i=Math.min(s,this.config.particleCount-this.particles.length,e-this.particles.length);for(let t=0;t<i;t++)this._createParticle()}}_handleVisibilityChange(){if(document.hidden&&this.config.pauseOnBlur)this.pause();else if(!document.hidden&&this.config.pauseOnBlur){const{clientWidth:i,clientHeight:t}=this.canvas;this.canvas.width===i&&this.canvas.height===t||this.resize(),this._lastTime=performance.now(),this.resume()}}_handleFocus(){this.config.pauseOnBlur&&!this._isScrollPaused&&this.resume()}_handleBlur(){this.config.pauseOnBlur&&this.pause()}updateConfig(i){const{randomizeDirection:t,...n}=i;for(Object.assign(this.config,n),this._fpsInterval=1e3/this.config.fpsLimit,this._maxDistanceSquared=this.config.maxDistance**2,this._gridCellSize=this.config.maxDistance;this.lightning.length;)this._recycleLightningBolt(this.lightning.pop());this._adjustParticleCount()}pause(){this._isPaused=!0}resume(){if(this._isPaused&&(this._isPaused=!1,this._lastTime=performance.now(),this.config.resetOnResume)){const{width:i,height:t}=this.canvas;for(let n=0,e=this.particles.length;n<e;n++){const e=this.particles[n];e.x=Math.random()*i,e.y=Math.random()*t}}}stop(){this._isRunning=!1,this._rafId&&(cancelAnimationFrame(this._rafId),this._rafId=null),this._removeEventListeners(),this.particles.length=0,this.lightning.length=0,this._lightningPool.length=0,this._spatialGrid.clear(),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}getFPS(){return Math.round(this._fps)}getParticleCount(){return this.particles.length}updateAvoidableAreas(i){this.avoidableAreas=[];const t=document.querySelectorAll(i),n=this.canvas.getBoundingClientRect();t.forEach(i=>{const t=i.getBoundingClientRect();this.avoidableAreas.push({x:t.left-n.left,y:t.top-n.top,width:t.width,height:t.height})})}isPaused(){return this._isPaused}isRunning(){return this._isRunning}}return i},"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(i="undefined"!=typeof globalThis?globalThis:i||self).LightningParticle=t();